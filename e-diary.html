<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Электронный дневник | SchoolDiary</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #49ee43;
            --primary-light: #eef2ff;
            --secondary: #37c95c;
            --success: #85f04c;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #48efa9;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --white: #ffffff;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 28px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 15px;
        }
        
        nav ul li a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        nav ul li a i {
            font-size: 18px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--white);
        }
        
        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-info {
            background-color: var(--info);
        }
        
        .btn-light {
            background-color: var(--light);
            color: var(--dark);
        }
        
        .page {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 20px;
            box-shadow: var(--box-shadow);
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .page-title {
            color: var(--primary);
            font-size: 24px;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 15px;
            transition: var(--transition);
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .alert {
            padding: 12px 16px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .alert-success {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }
        
        .alert-error {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
        }
        
        .alert-icon {
            font-size: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }
        
        th {
            background-color: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px;
        }
        
        tr:hover {
            background-color: var(--primary-light);
        }
        
        .hidden {
            display: none;
        }
        
        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background-color: var(--white);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
        }
        
        .stat-card h4 {
            margin: 0 0 10px;
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
        }
        
        .stat-card p {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin: 0;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .badge-success {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }
        
        .badge-danger {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger);
        }
        
        .badge-warning {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning);
        }
        
        .badge-info {
            background-color: rgba(72, 149, 239, 0.1);
            color: var(--info);
        }
        
        .grade {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-weight: 600;
            font-size: 14px;
        }
        
        .grade-5 {
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--success);
        }
        
        .grade-4 {
            background-color: rgba(72, 149, 239, 0.2);
            color: var(--info);
        }
        
        .grade-3 {
            background-color: rgba(248, 150, 30, 0.2);
            color: var(--warning);
        }
        
        .grade-2 {
            background-color: rgba(247, 37, 133, 0.2);
            color: var(--danger);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--gray-light);
        }
        
        .empty-text {
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            font-weight: 500;
            color: var(--gray);
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }
        
        .tab:hover:not(.active) {
            color: var(--dark);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-light);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .student-list {
            list-style: none;
        }
        
        .student-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background-color: var(--white);
            margin-bottom: 8px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .student-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
        }
        
        .student-avatar {
            margin-right: 15px;
        }
        
        .student-info {
            flex: 1;
        }
        
        .student-name {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .student-email {
            font-size: 13px;
            color: var(--gray);
        }
        
        .student-stats {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .schedule-day {
            margin-bottom: 25px;
        }
        
        .schedule-day-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .schedule-lesson {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: var(--white);
            margin-bottom: 8px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .schedule-lesson:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
        }
        
        .lesson-time {
            font-weight: 600;
            color: var(--primary);
            min-width: 120px;
        }
        
        .lesson-subject {
            flex: 1;
            font-weight: 500;
        }
        
        .lesson-room {
            color: var(--gray);
            min-width: 80px;
        }
        
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <span class="material-icons logo-icon">school</span>
                <span>SchoolDiary</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" onclick="showPage('dashboard')"><i class="material-icons">home</i>Главная</a></li>
                    <li><a href="#" onclick="showPage('schedule')"><i class="material-icons">schedule</i>Расписание</a></li>
                    <li><a href="#" onclick="showPage('journal')" id="journal-link" class="hidden"><i class="material-icons">book</i>Журнал</a></li>
                </ul>
            </nav>
            <div class="user-info" id="user-info">
                <div class="user-avatar" id="user-avatar"></div>
                <button class="btn btn-outline" onclick="logout()" id="logout-btn"><i class="material-icons">logout</i>Выйти</button>
            </div>
            <div class="auth-buttons" id="auth-buttons">
                <button class="btn btn-outline" onclick="showPage('login')"><i class="material-icons">login</i>Вход</button>
                <button class="btn" onclick="showPage('register')"><i class="material-icons">person_add</i>Регистрация</button>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="alerts"></div>
        
        <!-- Страница входа -->
        <div id="login-page" class="page hidden">
            <div class="page-header">
                <h2 class="page-title"><i class="material-icons">login</i> Вход в систему</h2>
            </div>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label for="login-email" class="form-label">Email:</label>
                    <input type="email" id="login-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="login-password" class="form-label">Пароль:</label>
                    <input type="password" id="login-password" class="form-control" required>
                </div>
                <button type="submit" class="btn"><i class="material-icons">login</i> Войти</button>
            </form>
            <p style="margin-top: 20px; text-align: center;">Нет аккаунта? <a href="#" onclick="showPage('register')" style="color: var(--primary);">Зарегистрируйтесь</a></p>
        </div>
        
        <!-- Страница регистрации -->
        <div id="register-page" class="page hidden">
            <div class="page-header">
                <h2 class="page-title"><i class="material-icons">person_add</i> Регистрация</h2>
            </div>
            <form onsubmit="register(event)">
                <div class="form-group">
                    <label for="reg-fullname" class="form-label">ФИО:</label>
                    <input type="text" id="reg-fullname" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="reg-email" class="form-label">Email:</label>
                    <input type="email" id="reg-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="reg-class" class="form-label">Класс:</label>
                    <input type="text" id="reg-class" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="reg-role" class="form-label">Роль:</label>
                    <select id="reg-role" class="form-control" required onchange="toggleChildField()">
                        <option value="">Выберите роль</option>
                        <option value="teacher">Учитель</option>
                        <option value="student">Ученик</option>
                        <option value="parent">Родитель</option>
                    </select>
                </div>
                <div class="form-group hidden" id="child-field">
                    <label for="reg-child" class="form-label">ФИО ребенка:</label>
                    <input type="text" id="reg-child" class="form-control">
                </div>
                <div class="form-group">
                    <label for="reg-password" class="form-label">Пароль:</label>
                    <input type="password" id="reg-password" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="reg-confirm-password" class="form-label">Подтвердите пароль:</label>
                    <input type="password" id="reg-confirm-password" class="form-control" required>
                </div>
                <button type="submit" class="btn"><i class="material-icons">person_add</i> Зарегистрироваться</button>
            </form>
        </div>
        
        <!-- Главная страница -->
        <div id="dashboard-page" class="page hidden">
            <div class="page-header">
                <h2 class="page-title"><i class="material-icons">dashboard</i> Главная страница</h2>
            </div>
            <div id="dashboard-content"></div>
        </div>
        
        <!-- Расписание -->
        <div id="schedule-page" class="page hidden">
            <div class="page-header">
                <h2 class="page-title"><i class="material-icons">schedule</i> Расписание занятий</h2>
            </div>
            <div id="schedule-content"></div>
        </div>
        
        <!-- Журнал -->
        <div id="journal-page" class="page hidden">
            <div class="page-header">
                <h2 class="page-title"><i class="material-icons">book</i> Журнал успеваемости</h2>
            </div>
            <div id="journal-content"></div>
        </div>
    </div>

    <script>
        // База данных в localStorage
        const database = {
            users: JSON.parse(localStorage.getItem('users')) || [],
            schedule: JSON.parse(localStorage.getItem('schedule')) || [],
            journal: JSON.parse(localStorage.getItem('journal')) || [],
            
            saveUsers: function() {
                localStorage.setItem('users', JSON.stringify(this.users));
            },
            
            saveSchedule: function() {
                localStorage.setItem('schedule', JSON.stringify(this.schedule));
            },
            
            saveJournal: function() {
                localStorage.setItem('journal', JSON.stringify(this.journal));
            },
            
            // Инициализация тестовых данных
            init: function() {
                if (this.users.length === 0) {
                    // Тестовый учитель
                    this.users.push({
                        id: 1,
                        fullName: "Иванова Мария Петровна",
                        email: "teacher@school.ru",
                        class: "5А",
                        role: "teacher",
                        password: "teacher123",
                        childId: null
                    });
                    
                    // Тестовый ученик
                    this.users.push({
                        id: 2,
                        fullName: "Петров Иван Сергеевич",
                        email: "student@school.ru",
                        class: "5А",
                        role: "student",
                        password: "student123",
                        childId: null
                    });
                    
                    // Тестовый родитель
                    this.users.push({
                        id: 3,
                        fullName: "Петрова Ольга Ивановна",
                        email: "parent@school.ru",
                        class: "5А",
                        role: "parent",
                        password: "parent123",
                        childId: 2
                    });
                    
                    // Еще тестовые данные
                    const classes = ["5А", "5Б", "6А", "6Б", "7А", "7Б"];
                    const subjects = ["Математика", "Русский язык", "Литература", "История", "Биология", "География", "Физика", "Химия"];
                    
                    // Добавляем учеников для разных классов
                    classes.forEach(class_ => {
                        for (let i = 1; i <= 5; i++) {
                            this.users.push({
                                id: this.users.length + 1,
                                fullName: `Ученик ${class_} ${i}`,
                                email: `student${class_}${i}@school.ru`,
                                class: class_,
                                role: "student",
                                password: "student123",
                                childId: null
                            });
                        }
                    });
                    
                    // Добавляем учителей для разных классов
                    classes.forEach(class_ => {
                        this.users.push({
                            id: this.users.length + 1,
                            fullName: `Учитель ${class_}`,
                            email: `teacher${class_}@school.ru`,
                            class: class_,
                            role: "teacher",
                            password: "teacher123",
                            childId: null
                        });
                    });
                    
                    this.saveUsers();
                }
                
                if (this.schedule.length === 0) {
                    const days = ["Понедельник", "Вторник", "Среда", "Четверг", "Пятница"];
                    const subjects = ["Математика", "Русский язык", "Литература", "История", "Биология", "География"];
                    const classes = ["5А", "5Б", "6А", "6Б", "7А", "7Б"];
                    
                    classes.forEach(class_ => {
                        days.forEach(day => {
                            for (let i = 0; i < 6; i++) {
                                this.schedule.push({
                                    id: this.schedule.length + 1,
                                    class: class_,
                                    day: day,
                                    subject: subjects[Math.floor(Math.random() * subjects.length)],
                                    time: `${8 + i}:00 - ${8 + i + 1}:00`,
                                    room: `${200 + Math.floor(Math.random() * 100)}`
                                });
                            }
                        });
                    });
                    
                    this.saveSchedule();
                }
                
                if (this.journal.length === 0) {
                    const dates = ["2023-09-01", "2023-09-02", "2023-09-05", "2023-09-06", "2023-09-07", "2023-09-08", "2023-09-09"];
                    const subjects = ["Математика", "Русский язык", "Литература", "История", "Биология", "География"];
                    const classes = ["5А", "5Б", "6А", "6Б", "7А", "7Б"];
                    
                    classes.forEach(class_ => {
                        const classStudents = this.users.filter(u => u.class === class_ && u.role === "student");
                        
                        dates.forEach(date => {
                            subjects.forEach(subject => {
                                classStudents.forEach(student => {
                                    this.journal.push({
                                        id: this.journal.length + 1,
                                        studentId: student.id,
                                        date: date,
                                        subject: subject,
                                        attendance: Math.random() > 0.2,
                                        grade: Math.random() > 0.3 ? Math.floor(Math.random() * 4) + 2 : null,
                                        homework: "Подготовить доклад по теме урока",
                                        teacherNotes: ""
                                    });
                                });
                            });
                        });
                    });
                    
                    this.saveJournal();
                }
            },
            
            // Получить все классы
            getClasses: function() {
                const classes = new Set();
                this.users.forEach(user => {
                    if (user.class) classes.add(user.class);
                });
                return Array.from(classes).sort();
            }
        };
        
        // Текущий пользователь
        let currentUser = null;
        // Текущий выбранный класс для журнала
        let currentJournalClass = null;
        
        // Инициализация при загрузке
        window.onload = function() {
            database.init();
            showPage('login');
            
            // Проверяем, есть ли сохраненный пользователь
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUI();
                showPage('dashboard');
            }
        };
        
        // Показать страницу
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            document.getElementById(`${pageId}-page`).classList.remove('hidden');
            
            // Загружаем контент для страницы
            switch(pageId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'schedule':
                    loadSchedule();
                    break;
                case 'journal':
                    loadJournal();
                    break;
            }
        }
        
        // Обновление интерфейса
        function updateUI() {
            const authButtons = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            const journalLink = document.getElementById('journal-link');
            const userAvatar = document.getElementById('user-avatar');
            
            if (currentUser) {
                authButtons.classList.add('hidden');
                userInfo.classList.remove('hidden');
                
                // Устанавливаем аватар пользователя
                if (currentUser.fullName) {
                    const initials = currentUser.fullName.split(' ').map(n => n[0]).join('').toUpperCase();
                    userAvatar.textContent = initials;
                }
                
                // Показываем журнал только учителям
                if (currentUser.role === 'teacher') {
                    journalLink.classList.remove('hidden');
                } else {
                    journalLink.classList.add('hidden');
                }
            } else {
                authButtons.classList.remove('hidden');
                userInfo.classList.add('hidden');
                journalLink.classList.add('hidden');
            }
        }
        
        // Получить название роли
        function getRoleName(role) {
            switch(role) {
                case 'teacher': return 'Учитель';
                case 'student': return 'Ученик';
                case 'parent': return 'Родитель';
                default: return role;
            }
        }
        
        // Показать сообщение
        function showAlert(message, type) {
            const alerts = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'success' ? 'success' : 'error'}`;
            
            const icon = document.createElement('i');
            icon.className = `material-icons alert-icon`;
            icon.textContent = type === 'success' ? 'check_circle' : 'error';
            
            const text = document.createElement('span');
            text.textContent = message;
            
            alert.appendChild(icon);
            alert.appendChild(text);
            alerts.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }
        
        // Вход
        function login(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const user = database.users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                updateUI();
                showPage('dashboard');
                showAlert('Вход выполнен успешно!', 'success');
            } else {
                showAlert('Неверный email или пароль', 'error');
            }
        }
        
        // Регистрация
        function register(event) {
            event.preventDefault();
            
            const fullName = document.getElementById('reg-fullname').value;
            const email = document.getElementById('reg-email').value;
            const class_ = document.getElementById('reg-class').value;
            const role = document.getElementById('reg-role').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            
            // Проверки
            if (password !== confirmPassword) {
                showAlert('Пароли не совпадают', 'error');
                return;
            }
            
            if (database.users.some(u => u.email === email)) {
                showAlert('Пользователь с таким email уже существует', 'error');
                return;
            }
            
            let childId = null;
            if (role === 'parent') {
                const childName = document.getElementById('reg-child').value;
                const child = database.users.find(u => u.fullName === childName && u.class === class_);
                
                if (!child) {
                    showAlert('Ученик не найден. Проверьте ФИО и класс.', 'error');
                    return;
                }
                
                childId = child.id;
            }
            
            // Создаем нового пользователя
            const newUser = {
                id: database.users.length > 0 ? Math.max(...database.users.map(u => u.id)) + 1 : 1,
                fullName: fullName,
                email: email,
                class: class_,
                role: role,
                password: password,
                childId: childId
            };
            
            database.users.push(newUser);
            database.saveUsers();
            
            showAlert('Регистрация успешна! Теперь вы можете войти.', 'success');
            showPage('login');
        }
        
        // Выход
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUI();
            showPage('login');
            showAlert('Вы успешно вышли из системы', 'success');
        }
        
        // Показать/скрыть поле для ребенка
        function toggleChildField() {
            const role = document.getElementById('reg-role').value;
            const childField = document.getElementById('child-field');
            
            childField.classList.toggle('hidden', role !== 'parent');
        }
        
        // Загрузка главной страницы
        function loadDashboard() {
            const content = document.getElementById('dashboard-content');
            
            if (currentUser.role === 'teacher') {
                // Для учителя - список учеников и последние оценки
                const students = database.users.filter(u => u.class === currentUser.class && u.role === 'student');
                
                let html = `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="material-icons">group</i> Класс ${currentUser.class}</h3>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h4>Учеников</h4>
                                <p>${students.length}</p>
                            </div>
                            <div class="stat-card">
                                <h4>Средний балл</h4>
                                <p>${calculateAverageGrade(currentUser.class).toFixed(2)}</p>
                            </div>
                            <div class="stat-card">
                                <h4>Посещаемость</h4>
                                <p>${calculateAttendanceRate(currentUser.class)}%</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="material-icons">people</i> Ученики класса</h3>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ФИО</th>
                                    <th>Email</th>
                                    <th>Средний балл</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                students.forEach(student => {
                    const avgGrade = calculateStudentAverageGrade(student.id);
                    html += `
                        <tr>
                            <td>${student.fullName}</td>
                            <td>${student.email}</td>
                            <td>
                                ${avgGrade ? 
                                    `<span class="grade grade-${Math.round(avgGrade)}">${avgGrade.toFixed(2)}</span>` : 
                                    'Нет оценок'}
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="material-icons">assignment</i> Последние оценки класса</h3>
                        </div>
                `;
                
                // Последние оценки класса
                const classJournalEntries = database.journal
                    .filter(j => {
                        const student = database.users.find(u => u.id === j.studentId);
                        return student && student.class === currentUser.class;
                    })
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 10);
                
                if (classJournalEntries.length === 0) {
                    html += `
                        <div class="empty-state">
                            <i class="material-icons empty-icon">assignment</i>
                            <p class="empty-text">Нет данных об оценках</p>
                        </div>
                    `;
                } else {
                    html += `
                        <table>
                            <thead>
                                <tr>
                                    <th>Дата</th>
                                    <th>Ученик</th>
                                    <th>Предмет</th>
                                    <th>Оценка</th>
                                    <th>Домашнее задание</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    classJournalEntries.forEach(entry => {
                        const student = database.users.find(u => u.id === entry.studentId);
                        html += `
                            <tr>
                                <td>${entry.date}</td>
                                <td>${student ? student.fullName : 'Неизвестно'}</td>
                                <td>${entry.subject}</td>
                                <td>
                                    ${entry.grade ? 
                                        `<span class="grade grade-${entry.grade}">${entry.grade}</span>` : 
                                        'Нет оценки'}
                                </td>
                                <td>${entry.homework}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                            </tbody>
                        </table>
                    `;
                }
                
                html += `</div>`;
                
                content.innerHTML = html;
            } else if (currentUser.role === 'parent') {
                // Для родителя - информация о ребенке
                const child = database.users.find(u => u.id === currentUser.childId);
                
                if (child) {
                    const journalEntries = database.journal
                        .filter(j => j.studentId === child.id)
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 10);
                    
                    const avgGrade = calculateStudentAverageGrade(child.id);
                    const attendanceRate = calculateStudentAttendanceRate(child.id);
                    
                    let html = `
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="material-icons">child_care</i> Информация о вашем ребенке</h3>
                            </div>
                            <div style="padding: 20px;">
                                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                                    <div class="avatar">${getInitials(child.fullName)}</div>
                                    <div>
                                        <h3 style="margin-bottom: 5px;">${child.fullName}</h3>
                                        <p style="color: var(--gray);">Класс: ${child.class}</p>
                                    </div>
                                </div>
                                
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h4>Средний балл</h4>
                                        <p>${avgGrade ? avgGrade.toFixed(2) : 'Нет'}</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>Посещаемость</h4>
                                        <p>${attendanceRate}%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="material-icons">grade</i> Последние оценки</h3>
                            </div>
                    `;
                    
                    if (journalEntries.length === 0) {
                        html += `
                            <div class="empty-state">
                                <i class="material-icons empty-icon">grade</i>
                                <p class="empty-text">Нет данных об оценках</p>
                            </div>
                        `;
                    } else {
                        html += `
                            <table>
                                <thead>
                                    <tr>
                                        <th>Дата</th>
                                        <th>Предмет</th>
                                        <th>Посещаемость</th>
                                        <th>Оценка</th>
                                        <th>Домашнее задание</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        
                        journalEntries.forEach(entry => {
                            html += `
                                <tr>
                                    <td>${entry.date}</td>
                                    <td>${entry.subject}</td>
                                    <td>
                                        <span class="badge ${entry.attendance ? 'badge-success' : 'badge-danger'}">
                                            ${entry.attendance ? 'Присутствовал' : 'Отсутствовал'}
                                        </span>
                                    </td>
                                    <td>
                                        ${entry.grade ? 
                                            `<span class="grade grade-${entry.grade}">${entry.grade}</span>` : 
                                            'Нет оценки'}
                                    </td>
                                    <td>${entry.homework}</td>
                                </tr>
                            `;
                        });
                        
                        html += `
                                </tbody>
                            </table>
                        `;
                    }
                    
                    html += `</div>`;
                    
                    content.innerHTML = html;
                } else {
                    content.innerHTML = `
                        <div class="card">
                            <div class="empty-state">
                                <i class="material-icons empty-icon">warning</i>
                                <p class="empty-text">Информация о ребенке не найдена</p>
                            </div>
                        </div>
                    `;
                }
            } else {
                // Для ученика - его оценки
                const journalEntries = database.journal
                    .filter(j => j.studentId === currentUser.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 10);
                
                const avgGrade = calculateStudentAverageGrade(currentUser.id);
                const attendanceRate = calculateStudentAttendanceRate(currentUser.id);
                
                let html = `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="material-icons">person</i> Ваша успеваемость</h3>
                        </div>
                        <div style="padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                                <div class="avatar">${getInitials(currentUser.fullName)}</div>
                                <div>
                                    <h3 style="margin-bottom: 5px;">${currentUser.fullName}</h3>
                                    <p style="color: var(--gray);">Класс: ${currentUser.class}</p>
                                </div>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <h4>Средний балл</h4>
                                    <p>${avgGrade ? avgGrade.toFixed(2) : 'Нет'}</p>
                                </div>
                                <div class="stat-card">
                                    <h4>Посещаемость</h4>
                                    <p>${attendanceRate}%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="material-icons">grade</i> Последние оценки</h3>
                        </div>
                `;
                
                if (journalEntries.length === 0) {
                    html += `
                        <div class="empty-state">
                            <i class="material-icons empty-icon">grade</i>
                            <p class="empty-text">У вас пока нет оценок</p>
                        </div>
                    `;
                } else {
                    html += `
                        <table>
                            <thead>
                                <tr>
                                    <th>Дата</th>
                                    <th>Предмет</th>
                                    <th>Посещаемость</th>
                                    <th>Оценка</th>
                                    <th>Домашнее задание</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    journalEntries.forEach(entry => {
                        html += `
                            <tr>
                                <td>${entry.date}</td>
                                <td>${entry.subject}</td>
                                <td>
                                    <span class="badge ${entry.attendance ? 'badge-success' : 'badge-danger'}">
                                        ${entry.attendance ? 'Присутствовал' : 'Отсутствовал'}
                                    </span>
                                </td>
                                <td>
                                    ${entry.grade ? 
                                        `<span class="grade grade-${entry.grade}">${entry.grade}</span>` : 
                                        'Нет оценки'}
                                </td>
                                <td>${entry.homework}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                            </tbody>
                        </table>
                    `;
                }
                
                html += `</div>`;
                
                content.innerHTML = html;
            }
        }
        
        // Получить инициалы из ФИО
        function getInitials(fullName) {
            if (!fullName) return '';
            return fullName.split(' ').map(n => n[0]).join('').toUpperCase();
        }
        
        // Рассчитать средний балл ученика
        function calculateStudentAverageGrade(studentId) {
            const grades = database.journal
                .filter(j => j.studentId === studentId && j.grade)
                .map(j => j.grade);
            
            if (grades.length === 0) return null;
            
            return grades.reduce((sum, grade) => sum + grade, 0) / grades.length;
        }
        
        // Рассчитать средний балл класса
        function calculateAverageGrade(class_) {
            const students = database.users.filter(u => u.class === class_ && u.role === 'student');
            const grades = [];
            
            students.forEach(student => {
                const studentGrades = database.journal
                    .filter(j => j.studentId === student.id && j.grade)
                    .map(j => j.grade);
                
                grades.push(...studentGrades);
            });
            
            if (grades.length === 0) return 0;
            
            return grades.reduce((sum, grade) => sum + grade, 0) / grades.length;
        }
        
        // Рассчитать посещаемость ученика
        function calculateStudentAttendanceRate(studentId) {
            const entries = database.journal.filter(j => j.studentId === studentId);
            if (entries.length === 0) return 0;
            
            const presentCount = entries.filter(j => j.attendance).length;
            return Math.round((presentCount / entries.length) * 100);
        }
        
        // Рассчитать посещаемость класса
        function calculateAttendanceRate(class_) {
            const entries = database.journal.filter(j => {
                const student = database.users.find(u => u.id === j.studentId);
                return student && student.class === class_;
            });
            
            if (entries.length === 0) return 0;
            
            const presentCount = entries.filter(j => j.attendance).length;
            return Math.round((presentCount / entries.length) * 100);
        }
        
        // Загрузка расписания
        function loadSchedule() {
            const content = document.getElementById('schedule-content');
            const classSchedule = database.schedule.filter(s => s.class === currentUser.class);
            
            const days = {};
            classSchedule.forEach(item => {
                if (!days[item.day]) {
                    days[item.day] = [];
                }
                days[item.day].push(item);
            });
            
            let html = '';
            
            // Форма добавления расписания (только для учителей)
            if (currentUser.role === 'teacher') {
                html += `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="material-icons">edit_calendar</i> Управление расписанием</h3>
                        </div>
                        <div style="padding: 20px;">
                            <form onsubmit="addScheduleItem(event)">
                                <div class="form-group">
                                    <label for="schedule-day" class="form-label">День недели:</label>
                                    <select id="schedule-day" class="form-control" required>
                                        <option value="Понедельник">Понедельник</option>
                                        <option value="Вторник">Вторник</option>
                                        <option value="Среда">Среда</option>
                                        <option value="Четверг">Четверг</option>
                                        <option value="Пятница">Пятница</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="schedule-time" class="form-label">Время:</label>
                                    <input type="text" id="schedule-time" class="form-control" placeholder="08:30-09:15" required>
                                </div>
                                <div class="form-group">
                                    <label for="schedule-subject" class="form-label">Предмет:</label>
                                    <input type="text" id="schedule-subject" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="schedule-room" class="form-label">Кабинет:</label>
                                    <input type="text" id="schedule-room" class="form-control" required>
                                </div>
                                <button type="submit" class="btn"><i class="material-icons">add</i> Добавить в расписание</button>
                            </form>
                        </div>
                    </div>
                `;
            }
            
            html += '<div class="card"><div class="card-header"><h3 class="card-title"><i class="material-icons">calendar_today</i> Расписание занятий</h3></div><div style="padding: 20px;">';
            
            if (Object.keys(days).length === 0) {
                html += `
                    <div class="empty-state">
                        <i class="material-icons empty-icon">schedule</i>
                        <p class="empty-text">Расписание не найдено</p>
                    </div>
                `;
            } else {
                for (const day in days) {
                    html += `
                        <div class="schedule-day">
                            <h4 class="schedule-day-title"><i class="material-icons">event</i> ${day}</h4>
                    `;
                    
                    days[day].forEach(lesson => {
                        html += `
                            <div class="schedule-lesson">
                                <div class="lesson-time">${lesson.time}</div>
                                <div class="lesson-subject">${lesson.subject}</div>
                                <div class="lesson-room">Каб. ${lesson.room}</div>
                                ${currentUser.role === 'teacher' ? 
                                  `<button onclick="removeScheduleItem(${lesson.id})" class="btn btn-danger"><i class="material-icons">delete</i></button>` : ''}
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
            }
            
            html += '</div></div>';
            content.innerHTML = html;
        }
        
        // Добавление пункта расписания
        function addScheduleItem(event) {
            event.preventDefault();
            
            if (currentUser.role !== 'teacher') {
                showAlert('Только учителя могут редактировать расписание', 'error');
                return;
            }

            const day = document.getElementById('schedule-day').value;
            const time = document.getElementById('schedule-time').value;
            const subject = document.getElementById('schedule-subject').value;
            const room = document.getElementById('schedule-room').value;

            const newItem = {
                id: database.schedule.length > 0 ? Math.max(...database.schedule.map(i => i.id)) + 1 : 1,
                class: currentUser.class,
                day: day,
                time: time,
                subject: subject,
                room: room
            };

            database.schedule.push(newItem);
            database.saveSchedule();
            
            showAlert('Пункт расписания добавлен', 'success');
            loadSchedule(); // Перезагружаем расписание
            
            // Очищаем форму
            document.getElementById('schedule-time').value = '';
            document.getElementById('schedule-subject').value = '';
            document.getElementById('schedule-room').value = '';
        }

        // Удаление пункта расписания
        function removeScheduleItem(id) {
            if (currentUser.role !== 'teacher') {
                showAlert('Только учителя могут редактировать расписание', 'error');
                return;
            }
            
            const index = database.schedule.findIndex(item => item.id === id);
            if (index !== -1) {
                database.schedule.splice(index, 1);
                database.saveSchedule();
                showAlert('Пункт расписания удален', 'success');
                loadSchedule();
            }
        }
        
        // Загрузка журнала (для учителей)
        function loadJournal() {
            const content = document.getElementById('journal-content');
            
            if (currentUser.role !== 'teacher') {
                content.innerHTML = `
                    <div class="card">
                        <div class="empty-state">
                            <i class="material-icons empty-icon">block</i>
                            <p class="empty-text">Доступ запрещен</p>
                        </div>
                    </div>
                `;
                return;
            }

            // Если класс не выбран, используем класс текущего пользователя
            if (!currentJournalClass) {
                currentJournalClass = currentUser.class;
            }
            
            const classes = database.getClasses();
            const students = database.users.filter(u => u.class === currentJournalClass && u.role === 'student');
            const journalEntries = database.journal
                .filter(j => {
                    const student = database.users.find(u => u.id === j.studentId);
                    return student && student.class === currentJournalClass;
                })
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = `
                <div class="card">
                    <div style="padding: 20px;">
                        <div class="form-group">
                            <label for="journal-class-select" class="form-label">Класс:</label>
                            <select id="journal-class-select" class="form-control" onchange="changeJournalClass(this.value)">
                                ${classes.map(class_ => 
                                    `<option value="${class_}" ${class_ === currentJournalClass ? 'selected' : ''}>${class_}</option>`
                                ).join('')}
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div style="padding: 20px;">
                        <div class="tabs">
                            <div class="tab active" onclick="switchJournalTab('students')"><i class="material-icons">group</i> Ученики</div>
                            <div class="tab" onclick="switchJournalTab('grades')"><i class="material-icons">grade</i> Оценки</div>
                            <div class="tab" onclick="switchJournalTab('add-grade')"><i class="material-icons">add</i> Добавить оценку</div>
                        </div>
                        
                        <div id="students-tab" class="tab-content active">
                            <div class="card" style="box-shadow: none; border: 1px solid var(--gray-light);">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="material-icons">group_add</i> Добавить ученика</h3>
                                </div>
                                <div style="padding: 20px;">
                                    <form onsubmit="addStudent(event)">
                                        <div class="form-group">
                                            <label for="new-student-name" class="form-label">ФИО ученика:</label>
                                            <input type="text" id="new-student-name" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="new-student-email" class="form-label">Email:</label>
                                            <input type="email" id="new-student-email" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="new-student-password" class="form-label">Пароль:</label>
                                            <input type="password" id="new-student-password" class="form-control" required>
                                        </div>
                                        <button type="submit" class="btn"><i class="material-icons">person_add</i> Добавить ученика</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card" style="box-shadow: none; border: 1px solid var(--gray-light); margin-top: 20px;">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="material-icons">people</i> Список учеников (${students.length})</h3>
                                </div>
                                <div style="padding: 20px;">
                                    <ul class="student-list">
            `;
            
            students.forEach(student => {
                const avgGrade = calculateStudentAverageGrade(student.id);
                html += `
                    <li class="student-item">
                        <div class="student-avatar">
                            <div class="avatar">${getInitials(student.fullName)}</div>
                        </div>
                        <div class="student-info">
                            <div class="student-name">${student.fullName}</div>
                            <div class="student-email">${student.email}</div>
                        </div>
                        <div class="student-stats">
                            <div>
                                <span style="font-size: 12px; color: var(--gray);">Средний балл:</span>
                                ${avgGrade ? 
                                    `<span class="grade grade-${Math.round(avgGrade)}">${avgGrade.toFixed(2)}</span>` : 
                                    '<span style="color: var(--gray);">Нет</span>'}
                            </div>
                        </div>
                    </li>
                `;
            });
            
            html += `
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div id="grades-tab" class="tab-content">
                            <div class="card" style="box-shadow: none; border: 1px solid var(--gray-light);">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="material-icons">assignment</i> Оценки класса ${currentJournalClass}</h3>
                                </div>
                                <div style="padding: 20px;">
            `;
            
            if (journalEntries.length === 0) {
                html += `
                    <div class="empty-state">
                        <i class="material-icons empty-icon">assignment</i>
                        <p class="empty-text">Нет данных об оценках</p>
                    </div>
                `;
            } else {
                html += `
                    <table>
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Ученик</th>
                                <th>Предмет</th>
                                <th>Посещаемость</th>
                                <th>Оценка</th>
                                <th>Домашнее задание</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                journalEntries.slice(0, 20).forEach(entry => {
                    const student = database.users.find(u => u.id === entry.studentId);
                    html += `
                        <tr>
                            <td>${entry.date}</td>
                            <td>${student ? student.fullName : 'Неизвестно'}</td>
                            <td>${entry.subject}</td>
                            <td>
                                <span class="badge ${entry.attendance ? 'badge-success' : 'badge-danger'}">
                                    ${entry.attendance ? 'Присутствовал' : 'Отсутствовал'}
                                </span>
                            </td>
                            <td>
                                ${entry.grade ? 
                                    `<span class="grade grade-${entry.grade}">${entry.grade}</span>` : 
                                    'Нет оценки'}
                            </td>
                            <td>${entry.homework}</td>
                            <td>
                                <button onclick="removeJournalEntry(${entry.id})" class="btn btn-danger"><i class="material-icons">delete</i></button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }
            
            html += `
                                </div>
                            </div>
                        </div>
                        
                        <div id="add-grade-tab" class="tab-content">
                            <div class="card" style="box-shadow: none; border: 1px solid var(--gray-light);">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="material-icons">note_add</i> Добавить запись в журнал</h3>
                                </div>
                                <div style="padding: 20px;">
                                    <form onsubmit="addJournalEntry(event)">
                                        <div class="form-group">
                                            <label for="journal-student" class="form-label">Ученик:</label>
                                            <select id="journal-student" class="form-control" required>
                                                ${students.map(s => `<option value="${s.id}">${s.fullName}</option>`).join('')}
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="journal-date" class="form-label">Дата:</label>
                                            <input type="date" id="journal-date" class="form-control" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="journal-subject" class="form-label">Предмет:</label>
                                            <input type="text" id="journal-subject" class="form-control" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Посещаемость:</label>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <label style="display: flex; align-items: center; gap: 5px;">
                                                    <input type="checkbox" id="journal-attendance" checked>
                                                    Присутствовал
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="journal-grade" class="form-label">Оценка (2-5):</label>
                                            <input type="number" id="journal-grade" class="form-control" min="2" max="5">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="journal-homework" class="form-label">Домашнее задание:</label>
                                            <textarea id="journal-homework" class="form-control"></textarea>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="journal-notes" class="form-label">Заметки учителя:</label>
                                            <textarea id="journal-notes" class="form-control"></textarea>
                                        </div>
                                        
                                        <button type="submit" class="btn"><i class="material-icons">save</i> Добавить запись</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
            
            // Устанавливаем сегодняшнюю дату по умолчанию
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('journal-date').value = today;
        }
        
        // Изменить выбранный класс для журнала
        function changeJournalClass(class_) {
            currentJournalClass = class_;
            loadJournal();
        }
        
        // Переключение вкладок в журнале
        function switchJournalTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[onclick="switchJournalTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        // Добавление ученика
        function addStudent(event) {
            event.preventDefault();
            
            if (currentUser.role !== 'teacher') {
                showAlert('Только учителя могут добавлять учеников', 'error');
                return;
            }

            const name = document.getElementById('new-student-name').value;
            const email = document.getElementById('new-student-email').value;
            const password = document.getElementById('new-student-password').value;

            // Проверка на существующий email
            if (database.users.some(u => u.email === email)) {
                showAlert('Ученик с таким email уже существует', 'error');
                return;
            }

            const newStudent = {
                id: database.users.length > 0 ? Math.max(...database.users.map(u => u.id)) + 1 : 1,
                fullName: name,
                email: email,
                class: currentJournalClass,
                role: 'student',
                password: password,
                childId: null
            };

            database.users.push(newStudent);
            database.saveUsers();
            
            showAlert('Ученик успешно добавлен', 'success');
            loadJournal(); // Перезагружаем журнал с обновленным списком учеников
            document.getElementById('new-student-name').value = '';
            document.getElementById('new-student-email').value = '';
            document.getElementById('new-student-password').value = '';
        }
        
        // Добавление записи в журнал
        function addJournalEntry(event) {
            event.preventDefault();
            
            const studentId = parseInt(document.getElementById('journal-student').value);
            const date = document.getElementById('journal-date').value;
            const subject = document.getElementById('journal-subject').value;
            const attendance = document.getElementById('journal-attendance').checked;
            const grade = document.getElementById('journal-grade').value;
            const homework = document.getElementById('journal-homework').value;
            const notes = document.getElementById('journal-notes').value;

            const newEntry = {
                id: database.journal.length > 0 ? Math.max(...database.journal.map(j => j.id)) + 1 : 1,
                studentId: studentId,
                date: date,
                subject: subject,
                attendance: attendance,
                grade: grade ? parseInt(grade) : null,
                homework: homework,
                teacherNotes: notes
            };

            database.journal.push(newEntry);
            database.saveJournal();
            
            showAlert('Запись добавлена успешно!', 'success');
            loadJournal();
            loadDashboard(); // Обновляем главную страницу, чтобы отобразить новую запись
            
            // Очищаем форму
            document.getElementById('journal-subject').value = '';
            document.getElementById('journal-grade').value = '';
            document.getElementById('journal-homework').value = '';
            document.getElementById('journal-notes').value = '';
        }

        // Удаление записи из журнала
        function removeJournalEntry(id) {
            const index = database.journal.findIndex(entry => entry.id === id);
            if (index !== -1) {
                database.journal.splice(index, 1);
                database.saveJournal();
                showAlert('Запись удалена', 'success');
                loadJournal();
                loadDashboard(); // Обновляем главную страницу
            }
        }
    </script>
</body>
</html>